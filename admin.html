<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>لوحة الأدمن - المتجر الحديث</title>
<link rel="stylesheet" href="css/admin_style.css">
 <link rel="shortcut icon" href="imgs/favicon.png" type="image/x-icon">
</head>
<body>

<header>المتجر الحديث - لوحة الأدمن</header>
<main class="container">
<h2>إدارة المتجر</h2>

<section class="admin-section">
<h3>إضافة منتج جديد</h3>
<form id="add-product-form">
  <input id="p-title" placeholder="اسم المنتج" required>
  <input id="p-price" placeholder="السعر" type="number" required>
  <textarea id="p-desc" placeholder="تفاصيل المنتج" required></textarea>
  <input id="p-image" type="file" accept="image/*">
  <button type="submit">إضافة المنتج</button>
</form>
</section>

<section class="admin-section">
<h3>قائمة المنتجات</h3>
<div id="admin-products" class="products-grid"></div>
</section>

<section class="admin-section">
<h3>طلبات العملاء</h3>
<div id="orders-list"></div>
</section>
</main>

<footer>
<p>© 2025 المتجر الحديث - جميع الحقوق محفوظة</p>
</footer>

<script>
const LS_PRODUCTS = 'mh_products_v1';
const LS_ORDERS = 'mh_orders_v1';

function loadOrders() {
  const raw = localStorage.getItem(LS_ORDERS);
  return raw ? JSON.parse(raw) : [];
}

function renderOrders() {
  const orders = loadOrders();
  const box = document.getElementById("orders-list");
  box.innerHTML = "";
  if (orders.length === 0) { box.innerHTML = "<p>لا توجد طلبات حتى الآن.</p>"; return; }
  orders.forEach(o=>{
    box.innerHTML += `<div class="order-box">
      <strong>اسم العميل:</strong> ${o.name}<br>
      <strong>رقم العميل:</strong> ${o.number}<br>
      <strong>المنتج:</strong> ${o.product}<br>
      <strong>عدد القطع:</strong> ${o.quantity}<br>
      <strong>وقت الطلب:</strong> ${o.time}
    </div>`;
  });
}

const defaultProducts = [
  {id:'p1', title:'هاتف ذكي - موديل A', price:299, desc:'هاتف حديث بمواصفات ممتازة', image:''},
  {id:'p2', title:'سماعات بلوتوث', price:49, desc:'سماعات صغيرة وعالية الجودة', image:''},
  {id:'p3', title:'غطاء حماية', price:9, desc:'غطاء حماية للهاتف', image:''}
];

function loadProducts(){ 
  const raw = localStorage.getItem(LS_PRODUCTS);
  if(raw) return JSON.parse(raw);
  localStorage.setItem(LS_PRODUCTS, JSON.stringify(defaultProducts));
  return defaultProducts;
}

function saveProducts(arr){ localStorage.setItem(LS_PRODUCTS, JSON.stringify(arr)) }

function formatCurrency(n){ return n + ' $'; }

function renderAdminPage(){
  const products = loadProducts();
  const cont = document.getElementById('admin-products');
  cont.innerHTML = '';
  products.forEach(p=>{
    const card = document.createElement('div'); card.className='product-card';
    card.innerHTML = `
      <img src="${p.image || 'https://via.placeholder.com/400x300?text=Product'}">
      <div class="product-title">${p.title}</div>
      <div class="product-price">${formatCurrency(p.price)}</div>
      <div class="product-desc">${p.desc}</div>
      <div class="card-buttons">
        <button class="btn edit-btn" data-id="${p.id}">تعديل</button>
        <button class="btn delete-product" data-id="${p.id}">حذف</button>
      </div>
      <div class="edit-form" id="edit-${p.id}">
        <input type="text" value="${p.title}">
        <input type="number" value="${p.price}">
        <textarea>${p.desc}</textarea>
        <input type="file" accept="image/*">
        <button class="btn save-edit" data-id="${p.id}">حفظ التعديلات</button>
      </div>`;
    cont.appendChild(card);
  });

  // حذف
  document.querySelectorAll('.delete-product').forEach(b=>{
    b.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id;
      let arr = loadProducts();
      arr = arr.filter(x=>x.id!==id);
      saveProducts(arr); renderAdminPage();
    });
  });

  // تعديل
  document.querySelectorAll('.edit-btn').forEach(b=>{
    b.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id;
      const form = document.getElementById('edit-'+id);
      form.style.display = form.style.display==='block'?'none':'block';
    });
  });

  document.querySelectorAll('.save-edit').forEach(b=>{
    b.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id;
      const form = document.getElementById('edit-'+id);
      const title = form.querySelector('input[type="text"]').value.trim();
      const price = parseFloat(form.querySelector('input[type="number"]').value);
      const desc = form.querySelector('textarea').value.trim();
      const imgFile = form.querySelector('input[type="file"]').files[0];
      if(!title || !price || !desc){ alert('اكمل البيانات'); return; }
      const arr = loadProducts();
      const prodIndex = arr.findIndex(x=>x.id===id);
      if(imgFile){
        const reader = new FileReader();
        reader.onload = ev=>{
          arr[prodIndex] = { id, title, price, desc, image: ev.target.result };
          saveProducts(arr); renderAdminPage();
        };
        reader.readAsDataURL(imgFile);
      } else {
        arr[prodIndex] = { id, title, price, desc, image: arr[prodIndex].image };
        saveProducts(arr); renderAdminPage();
      }
    });
  });
}

// إضافة منتج جديد
document.getElementById('add-product-form').addEventListener('submit', e=>{
  e.preventDefault();
  const title = document.getElementById('p-title').value.trim();
  const price = parseFloat(document.getElementById('p-price').value);
  const desc = document.getElementById('p-desc').value.trim();
  const imgFile = document.getElementById('p-image').files[0];
  if(!title || !price || !desc){ alert('اكمل البيانات'); return; }
  const id = 'p' + Date.now();
  if(imgFile){
    const reader = new FileReader();
    reader.onload = ev=>{
      const arr = loadProducts();
      arr.push({id, title, price, desc, image: ev.target.result});
      saveProducts(arr); renderAdminPage();
      e.target.reset();
    };
    reader.readAsDataURL(imgFile);
  } else {
    const arr = loadProducts();
    arr.push({id, title, price, desc, image: ''});
    saveProducts(arr); renderAdminPage();
    e.target.reset();
  }
});

document.addEventListener('DOMContentLoaded', ()=>{
  renderAdminPage(); renderOrders();
});
</script>

</body>
</html>
